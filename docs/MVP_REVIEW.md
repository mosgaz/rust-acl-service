# Оценка ТЗ и текущего состояния `rust-acl-service`

## 1) Краткий вывод

ТЗ в `docs/SPECIFICATION.md` в целом сформулировано корректно: хорошо определены термины, границы ответственности (AuthZ без AuthN), API-поверхности и нефункциональные ожидания.

Но для **старта без усложнений** текущая версия перегружена требованиями уровня production-ready v2 (двойной API REST+gRPC, ABAC, namespaces, Redis, tracing, circuit breaker, 10k RPS).

Текущее состояние репозитория: фактическая реализация Rust-сервиса отсутствует (нет `Cargo.toml`, `src/`, миграций, proto/openapi, тестов). По сути, сейчас это документ с ТЗ.

## 2) Что в ТЗ хорошо

- Четко зафиксирована цель: централизованный AuthZ и изоляция от бизнес-семантики.
- Нормально описан контракт `check(actor_id, action, resource, context)`.
- Отдельно выделены эксплуатационные требования (безопасность, наблюдаемость, отказоустойчивость).
- Есть критерии готовности и примеры использования.

## 3) Где ТЗ перегружено для первого этапа

### Слишком много обязательств одновременно

В одном релизе предлагается реализовать:
- RBAC + ABAC + потенциальная замена движка,
- REST и gRPC одновременно,
- клиентскую библиотеку с middleware и кэшированием,
- Redis, circuit breaker, retry policy,
- высокие SLO/SLA по задержке и RPS,
- observability стек целиком.

Это правильно как целевое состояние, но слишком рискованно как MVP.

### Нет разделения на фазы

В ТЗ нет явного разбиения на:
- **MVP (must-have),**
- **Phase 2 (should-have),**
- **Phase 3 (nice-to-have).**

Из-за этого растет вероятность затянуть запуск и усложнить архитектуру до появления реальных сценариев.

## 4) Рекомендованный MVP (без усложнений)

### Обязательный scope v0/v1

1. **Только RBAC** (без ABAC в логике принятия решения).
2. **Только один протокол API**: REST **или** gRPC (рекомендовано REST для быстрого старта интеграций).
3. **Один стор**: PostgreSQL (без Redis).
4. **Минимальный Check API**:
   - `POST /v1/check`
   - вход: `actor_id`, `action`, `resource`
   - выход: `allow: bool`
5. **Минимальный Admin API**:
   - роли,
   - назначения ролей пользователям,
   - права роли.
6. **Базовая эксплуатация**:
   - health/readiness,
   - структурные логи,
   - простые метрики (`request_count`, `request_latency`).
7. **Fail closed по умолчанию** для клиентов.

### Что отложить

- ABAC (context-aware matcher),
- namespaces,
- Redis и сложные схемы инвалидации,
- клиентские middleware для всех фреймворков,
- circuit breaker/адаптивные таймауты,
- целевой перфоманс 10k RPS как жесткий DoD.

## 5) Минимальные критерии готовности MVP

- Есть рабочий Rust сервис с `Cargo.toml` и модулем `src/`.
- Есть миграции БД для ролей/назначений/прав.
- Есть endpoint проверки доступа + базовый admin CRUD.
- Есть набор интеграционных тестов happy-path + deny-path.
- Есть docker-compose для локального запуска с PostgreSQL.
- Есть короткая инструкция запуска и примеры curl.

## 6) Оценка "функционала сервиса на Rust" сейчас

На текущий момент функционал как программного продукта отсутствует:
- нет исходного кода сервиса,
- нет схемы БД и миграций,
- нет API-контрактов в коде,
- нет тестов/CI конфигурации под выполнение.

Итог: реализацию следует считать на стадии **pre-implementation** (подготовлен только документ требований).

## 7) Практическое решение для старта

Чтобы не усложнять на начальном этапе, зафиксировать отдельно:

- `MVP scope` (RBAC only, single API, Postgres only),
- `Future scope` (ABAC, dual API, Redis, advanced resilience).

Это позволит быстро получить рабочий сервис и уже по реальной нагрузке решить, какие усложнения действительно нужны.
